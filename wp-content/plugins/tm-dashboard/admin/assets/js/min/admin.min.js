!function(e,t){"use strict";t.utilites.namespace("tmAdminNotice"),t.tmAdminNotice={noticeCreate:function(t,i,s){function a(){var t=100;e(".cherry-handler-notice").each(function(){e(this).css({top:t}),t+=e(this).outerHeight(!0)})}var n,r,o=0,d=s||!1;return!(!i||"true"===d)&&(n=e('<div class="cherry-handler-notice '+t+'"><span class="dashicons"></span><div class="inner">'+i+"</div></div>"),e("body").prepend(n),a(),o=-1*(n.outerWidth(!0)+10),n.css({right:o}),r=setTimeout(function(){n.css({right:10}).addClass("show-state")},100),r=setTimeout(function(){o=-1*(n.outerWidth(!0)+10),n.css({right:o}).removeClass("show-state")},15e3),void(r=setTimeout(function(){n.remove(),clearTimeout(r)},15500)))}},t.utilites.namespace("rateForm"),t.rateForm={formId:"#tm-rateform",sendReviewInstance:null,saveButtonId:".tm-rate-form__btn",saveHandlerId:"tm_rate_form_id",init:function(){window[this.saveHandlerId]&&(this.sendReviewInstance=new t.CherryAjaxHandler({handlerId:this.saveHandlerId,successCallback:this.sendSuccessCallback.bind(this)}),this.validateRateForm())},validateRateForm:function(){if(!e.isFunction(jQuery.fn.validate)||!e(this.formId).length)return!1;var t=this;e(this.formId).validate({debug:!0,errorElement:"span",rules:{tm_rate_title:{minlength:3}},submitHandler:function(e){t.sendReviewHandler()}})},sendReviewHandler:function(){this.disableButton(this.saveButtonId),this.sendReviewInstance.sendFormData(this.formId)},sendSuccessCallback:function(){this.enableButton(this.saveButtonId)},disableButton:function(t){e(t).attr("disabled","disabled")},enableButton:function(t){var i=null;e(t).removeAttr("disabled").addClass("success"),e(this.formId)[0].reset(),i=setTimeout(function(){e(t).removeClass("success"),clearTimeout(i)},1e3)}},t.utilites.namespace("verifiedTheme"),t.verifiedTheme={verifiedThemeId:"tm_verified_theme",themeForm:".tm-updates__theme-form",themeFormControls:".tm-updates__theme-form-controls",submiteButton:".verified-theme",errorClass:".error-field",verifiedTheme:null,init:function(){window[this.verifiedThemeId]&&(this.verifiedTheme=new t.CherryAjaxHandler({handlerId:this.verifiedThemeId,successCallback:this.checkVerifiedThemeCallback.bind(this)}),this.addEvents())},addEvents:function(){e(this.themeForm).on("click",this.submiteButton,this.checkVerifiedTheme.bind(this)).on("click",this.errorClass,this.removeErrorClass.bind(this))},checkVerifiedTheme:function(t){var i,s,a=t.target,n=e(t.delegateTarget);return this.disableButton(a),i=n.serializeArray(),(s=this.validateForm(i))?(e(s,n).addClass("error-field"),this.enableButton(a,"error"),!1):(e(".utb-js").not(a).attr("disabled","disabled").addClass("disabled"),this.verifiedTheme.sendData(i),!1)},validateForm:function(e){for(var t,i,s=e.length-1,a="";s>=0;s--)t=e[s].value,i=e[s].name,t||(a+=',[name="'+i+'"]');return a=a.replace(/^,/,"")},removeErrorClass:function(t){var i=e(t.target),s=this.errorClass.replace(/^\./,"");i.removeClass(s)},checkVerifiedThemeCallback:function(i){var s=i.data,a=e("#"+s.slug),n=e(this.submiteButton,a),r=e(this.themeFormControls,a),o=s.htmlForm;return e(".utb-js").removeAttr("disabled").removeClass("disabled"),s.verify?(o&&r.removeClass("show-form").addClass("hide-form").on("animationend",this.showControls.bind(this,r,o)),t.tmAdminNotice.noticeCreate("success-notice",s.message),this.enableButton(e(n,a),"success"),!1):(t.tmAdminNotice.noticeCreate("error-notice",s.message),this.enableButton(n,"error"),!1)},showControls:function(e,t){e.html(t).removeClass("hide-form").addClass("show-form")},disableButton:function(t){e(t).attr("disabled","disabled")},enableButton:function(t,i){var s=null;e(t).removeAttr("disabled").addClass(i),s=setTimeout(function(){e(t).removeClass(i),clearTimeout(s)},1e3)}},t.utilites.namespace("updateTheme"),t.updateTheme={ajaxHandlerId:"tm_update_theme",ajaxHandler:null,themeForm:".tm-updates__theme-form",submiteButton:".tm-update-theme",continueUpdateButton:"#update-theme-continue",popUP:".tm-updates-popup",closePopUpButton:"#update-theme-cancel",popUpBg:".tm-updates-popup-background",themeImage:".tm-updates__theme-image",imageLable:".tm-notification-image-lable",errorClass:".error-field",tempData:null,init:function(){window[this.ajaxHandlerId]&&(this.ajaxHandler=new t.CherryAjaxHandler({handlerId:this.ajaxHandlerId,successCallback:this.ajaxHandlerCallback.bind(this)}),this.addEvents())},addEvents:function(){e(this.themeForm).on("click",this.submiteButton,this.checkUpdateTheme.bind(this)),e("body").on("click.tm-update",this.popUpBg,this.canselUpdate.bind(this)).on("click.tm-update",this.closePopUpButton,this.canselUpdate.bind(this)).on("click.tm-update",this.continueUpdateButton,this.startUpdate.bind(this))},checkUpdateTheme:function(t){var i=t.target,s=e(t.delegateTarget),a={slug:s.attr("name"),version:e('[name="version"]',s).val(),updateVersion:e('[name="update-version"]',s).val()};return this.tempData=a,this.disableButton(i),e(".utb-js").not(i).attr("disabled","disabled").addClass("disabled"),e(this.popUP).addClass("show open"),e(window).one("keyup",this.canselUpdate.bind(this)),!1},startUpdate:function(){var t;return this.tempData?(this.ajaxHandler.sendData(this.tempData),this.tempData=null):(this.tempData=null,t=e("#check-theme-"+this.tempData.slug),this.enableButton(t,"error")),this.hidePopUp(),!1},canselUpdate:function(t){if("keyup"===t.type&&27!==t.keyCode)return!1;if(!this.tempData)return!1;var i=e("#check-theme-"+this.tempData.slug);return this.tempData=null,this.hidePopUp(),this.enableButton(i,"error"),e(".utb-js").removeAttr("disabled").removeClass("disabled"),!1},hidePopUp:function(){e(this.popUP).removeClass("open"),e(".tm-updates-popup-inner",this.popUP).one("animationend",this.hidePopUpWrapper.bind(this))},hidePopUpWrapper:function(){e(this.popUP).removeClass("show")},ajaxHandlerCallback:function(i){var s,a=i.data,n=e("#"+a.slug),r=(e(this.themeFormControls,n),e(this.submiteButton,n)),o=n.siblings(this.themeImage).find(this.imageLable);return a.error?(this.enableButton(r,"error"),t.tmAdminNotice.noticeCreate("error-notice",a.message),!1):(e(".current-version",n).html(a.updateVersion),e(".utb-js").removeAttr("disabled").removeClass("disabled"),this.enableButton(r,"success"),t.tmAdminNotice.noticeCreate("error-notice",a.message),void(s=setTimeout(function(){r.addClass("disabled").attr("disabled","disabled"),o.remove(),clearTimeout(s)},1e3)))},removeErrorClass:function(t){var i=e(t.target),s=this.errorClass.replace(/^\./,"");i.removeClass(s)},disableButton:function(t){e(t).attr("disabled","disabled")},enableButton:function(t,i){var s=null;e(t).removeAttr("disabled").addClass(i).removeClass("utb-js"),s=setTimeout(function(){e(t).removeClass(i),clearTimeout(s)},1e3)}},t.updateTheme.init(),t.verifiedTheme.init(),t.rateForm.init()}(jQuery,window.CherryJsCore);